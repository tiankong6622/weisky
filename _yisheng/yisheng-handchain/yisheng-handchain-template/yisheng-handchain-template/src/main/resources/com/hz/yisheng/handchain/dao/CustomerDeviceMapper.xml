<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hz.yisheng.handchain.dao.CustomerDeviceMapper">
	<resultMap type="com.hz.yisheng.handchain.orm.CustomerDevice" id="CUSTOMER_DEVICE_RESULT">
		<id property="id" column="id"/>
		<result property="customerId" column="customer_id"/>
		<result property="number" column="number"/>
		<result property="status" column="status"/>
		<result property="creator" column="creator"/>
		<result property="createTime" column="create_time"/>
		<result property="updater" column="updater"/>
		<result property="updateTime" column="update_time"/>
	</resultMap>	
	
	<sql id="CUSTOMER_DEVICE_SQL">
		customer_id,number,status,creator,create_time,updater,update_time
	</sql>
	
	<insert id="insert" parameterType="com.hz.yisheng.handchain.orm.CustomerDevice" useGeneratedKeys="true" keyProperty="id"  keyColumn="id">
		insert into customer_device(id,<include refid="CUSTOMER_DEVICE_SQL"/>) 
		values(id,#{customerId},#{number},#{status},#{creator},now(),#{updater},#{updateTime})
	</insert>
	
	<select id="list" parameterType="java.util.HashMap" resultMap="CUSTOMER_DEVICE_RESULT">
		select d.id,d.customer_id,d.number,d.status,d.creator,d.create_time,d.updater,d.update_time,c.name from customer_device d
		inner join customer_base c on c.id = d.customer_id
		where 1=1
		<if test="id != null">
			<![CDATA[ and d.id =#{id}]]>
		</if>
		<if test="name != null and name != ''">
			<![CDATA[ and name LIKE CONCAT('%',#{name},'%')]]>
		</if>
		<if test="customerId != null">
			<![CDATA[ and d.customer_id =#{customerId}]]>
		</if>
		<if test="number != null and number != ''">
			<![CDATA[ and d.number =#{number}]]>
		</if>
		<if test="status != null and status != ''">
			<![CDATA[ and d.status =#{status}]]>
		</if>
		<if test="rowStart!=null and pageSize!=null">
			<![CDATA[limit #{rowStart},#{pageSize}]]>
		</if> 
	</select>
	<select id="count" resultType="java.lang.Long" parameterType="java.util.HashMap">
		select count(id) from customer_device where 1=1
	</select>
	
</mapper>